# Firebase Services

This directory contains the Firebase service functions to interact with Firestore database. These services provide a clean API to perform CRUD operations on the following collections:

- Users
- Barangays
- Reports
- Members

## Schema

The schema for each collection is defined in `src/types/firestore.ts`.

### Users

```typescript
{
  id: "<auto-generated>",
  email: "user@example.com",
  passwordHash: "<hashed-password>", // Firebase Auth manages this
  role: "SK Official", // or "Admin"
  barangayId: "<barangay-id>",
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Barangays

```typescript
{
  id: "<auto-generated>",
  barangayName: "Barangay San Miguel",
  province: "Leyte",
  municipalityCity: "San Isidro",
  logoUrl: "https://storage.googleapis.com/.../barangay-logo.png", // Optional
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Reports

```typescript
{
  id: "<auto-generated>",
  title: "Q1 2025 Youth Profile Report",
  quarter: "Q1", // Q1, Q2, Q3, Q4
  year: "2025",
  barangayId: "<barangay-id>",
  createdBy: "<user-id>", // From Firebase Authentication
  createdAt: Timestamp,
  updatedAt: Timestamp,
  status: "draft", // or "generated", "submitted"
  memberCount: 22, // Auto-counted on report generation
  fileUrl: "https://storage.googleapis.com/.../report.pdf", // optional
  version: 1
}
```

### Members

```typescript
{
  id: "<auto-generated>",
  reportId: "<report-id>", // optional
  barangayId: "<barangay-id>",

  lastName: "Doe",
  firstName: "John",
  middleName: "Smith", // optional
  suffix: "Jr.", // optional

  age: 22,
  birthdayMonth: 1,
  birthdayDay: 15,
  birthdayYear: 2003,

  sexAssignedAtBirth: "Male", // "Male" or "Female"
  civilStatus: "Single", // "Single", "Married", etc.

  youthClassification: "In-School Youth", // ISY, OSY, WY, Others
  specialGroup: [ "Person with Disability" ], // Optional multiple choice
  youthAgeGroup: "Core Youth", // Child Youth (15-17), Core Youth (18-24), Young Adult (25-30)

  emailAddress: "john.doe@example.com", // optional
  contactNumber: "09123456789", // optional
  homeAddress: "123 Sample St, Barangay Kauswagan, Cagayan de Oro City",

  region: "REGION X",
  province: "MISAMIS ORIENTAL",
  cityMunicipality: "CAGAYAN DE ORO CITY",
  barangay: "BARANGAY KAUSWAGAN",
  sitioPurok: "Purok 3", // optional
  
  educationalAttainment: "College Graduate", // Elementary, High School, College, Masters, etc.
  workStatus: "Employed", // Employed, Unemployed, Self-Employed

  registeredSKVoter: "Y", // Y or N
  votedLastSKElection: "Y", // Y or N
  registeredNationalVoter: "Y", // Y or N
  attendedKKAssembly: "Y", // Y or N
  assemblyFrequency: 2, // integer (number of assemblies attended)

  signatureUrl: "https://storage.googleapis.com/.../signatures/xxx.png", // optional
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

## Services

Each collection has its own service file with functions to interact with the collection:

- `users.ts` - Functions for the Users collection
- `barangays.ts` - Functions for the Barangays collection
- `reports.ts` - Functions for the Reports collection
- `members.ts` - Functions for the Members collection

All services are exported from the `index.ts` file.

## Usage

Import the services from the `firebase` directory:

```typescript
import { createUser, getUserById } from '@/services/firebase';
```

See `examples.ts` for usage examples.

## Examples

### Creating a new user

```typescript
import { createUser } from '@/services/firebase';
import { User } from '@/types/firestore';

// After creating a user with Firebase Authentication
const firebaseUser = auth.currentUser;

// Create the user document in Firestore
const userData: Omit<User, 'id' | 'createdAt' | 'updatedAt'> = {
  email: firebaseUser.email,
  role: 'SK Official',
  barangayId: 'some-barangay-id',
};

const user = await createUser(userData, firebaseUser.uid);
```

### Creating a new report

```typescript
import { createReport } from '@/services/firebase';
import { Report } from '@/types/firestore';

const reportData: Omit<Report, 'id' | 'createdAt' | 'updatedAt' | 'version'> = {
  title: 'Q1 2025 Youth Profile Report',
  quarter: 'Q1',
  year: '2025',
  barangayId: 'some-barangay-id',
  createdBy: 'user-id',
  status: 'draft',
  memberCount: 0,
};

const report = await createReport(reportData);
```

### Adding a member to a report

```typescript
import { createMember } from '@/services/firebase';
import { Member } from '@/types/firestore';

const memberData: Omit<Member, 'id' | 'createdAt' | 'updatedAt'> = {
  reportId: 'report-id',
  barangayId: 'barangay-id',
  lastName: 'Doe',
  firstName: 'John',
  // ... other fields
};

const member = await createMember(memberData);
```

See `examples.ts` for more comprehensive examples.